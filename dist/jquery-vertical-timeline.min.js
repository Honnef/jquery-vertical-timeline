/*! jquery-vertical-timeline - v0.1.3 - 2014-01-20
* https://github.com/MinnPost/jquery-vertical-timeline
* Copyright (c) 2014 MinnPost; Licensed MIT */

!function(a){a.fn.verticalTimeline=function(b){var c={key:"https://docs.google.com/spreadsheet/pub?key=0AsmHVq28GtVJdG1fX3dsQlZrY18zTVA2ZG8wTXdtNHc&output=html",sheetName:"Posts",defaultDirection:"newest",defaultExpansion:"expanded",groupFunction:"groupSegmentByYear",sharing:!1,gutterWidth:56,width:"auto",handleResize:!1,tabletopOptions:{},columnMapping:{title:"title",title_icon:"title icon",date:"date",display_date:"display date",photo_url:"photo url",caption:"caption",body:"body",read_more_url:"read more url"},postTemplate:'         <div class="item post">           <div class="inner">             <div class="timestamp">{{timestamp}}</div>             <div class="title">                 <h3>                 {{#if title_icon}}<img class="title-icon" src="{{title_icon}}" />{{/if}}                 {{title}}                 </h3>             </div>             <div class="date">{{display_date}}</div>             <div class="body">               {{#if photo_url}}                 <img src="{{photo_url}}" alt="">               {{/if}}               {{#if caption}}                 <div class="caption">({{caption}})</div>               {{/if}}               {{#if body}}                 <div class="text">{{{body}}}</div>               {{/if}}               <div class="clearfix">                 {{#if read_more_url}}                   <a target="_blank" class="more" href="{{read_more_url}}">READ MORE</a>                   {{#if sharing}}                     <div class="share">                       <a href="#" class="share-trigger"></a>                       <div class="share-popup">                         <a href="https://twitter.com/share" class="twitter-share-button" data-url="{{read_more_url}}" data-text="{{title}}" data-count="none">Tweet</a>                         <a class="facebook-share-button" name="fb_share" type="button" share_url="{{read_more_url}}">Share</a>                       </div>                     </div>                   {{/if}}                 {{/if}}               </div>             </div>           </div>         </div>       ',groupMarkerTemplate:'         <div class="item group-marker item-group-{{id}}" data-id="{{id}}">           <div class="inner">             <div class="inner2">               <div class="timestamp">{{timestamp}}</div>               <div class="group">{{groupDisplay}}</div>             </div>           </div>         </div>       ',buttonTemplate:'         <div class="vertical-timeline-buttons">           <div class="expand-collapse-buttons">             <a class="expand-all active" href="#"><span>Expand all</span></a>             <a class="collapse-all" href="#"><span>Collapse all</span></a>           </div>           <div class="sort-buttons">             <a class="sort-newest active" href="#"><span>Newest first</span></a>             <a class="sort-oldest" href="#"><span>Oldest first</span></a>           </div>         </div>       ',timelineTemplate:'         <div class="vertical-timeline-timeline">           <div class="line-container">             <div class="line"></div>           </div>         </div>       '},d=function(a,b,c){var d=new Date(a.timestamp).getFullYear(),e=d.toString(),f=e.slice(0,-1);return b[f]={id:f,groupDisplay:f+"0's",timestamp:Date.parse("newest"==c?"December 31, "+f+"9":"January 1, "+f+"0"),timestampStart:Date.parse("January 1, "+f+"0"),timestampEnd:Date.parse("December 31, "+f+"9")},b},e=function(a,b,c){var d=new Date(a.timestamp).getFullYear();return b[d]={id:d,groupDisplay:d,timestamp:Date.parse("newest"==c?"December 31, "+d:"January 1, "+d),timestampStart:Date.parse("January 1, "+d),timestampEnd:Date.parse("December 31, "+d)},b},f=a.extend(c,b);return f.groupFunction="groupSegmentByYear"===f.groupFunction?e:f.groupFunction,f.groupFunction="groupSegmentByDecade"===f.groupFunction?d:f.groupFunction,this.each(function(){var b=a(this),c={},d={};if(b.addClass("vertical-timeline-container"),b.html(f.buttonTemplate+f.timelineTemplate),d.setupTimeline=function(e,g){var h=Handlebars.compile(f.postTemplate),i=Handlebars.compile(f.groupMarkerTemplate);g&&(e=g.sheets(f.sheetName).all()),a.each(e,function(a,d){c=f.groupFunction(d,c,f.defaultDirection),d.sharing=f.sharing,b.find(".vertical-timeline-timeline").append(h(d))}),a.each(c,function(a,c){b.find(".vertical-timeline-timeline").append(i(c))}),d.handleSharing(),d.handleExpanding(),d.handleSorting(),d.adjustWidth(),d.handleResizing(),b.find(".vertical-timeline-timeline").imagesLoaded(function(){b.find(".vertical-timeline-timeline").isotope({itemSelector:".item",transformsEnabled:!0,layoutMode:"spineAlign",spineAlign:{gutterWidth:f.gutterWidth},getSortData:{timestamp:function(a){return parseFloat(a.find(".timestamp").text())}},sortBy:"timestamp",sortAscending:"newest"==f.defaultDirection?!1:!0,itemPositionDataEnabled:!0,onLayout:function(){d.adjustLine()}})})},d.handleSharing=function(){f.sharing&&(a.getScript("//static.ak.fbcdn.net/connect.php/js/FB.Share"),a.getScript("//platform.twitter.com/widgets.js"),b.find(".vertical-timeline-timeline .post .share").hover(function(){a(this).find(".share-trigger").addClass("over"),a(this).find(".share-popup").show()},function(){a(this).find(".share-trigger").removeClass("over"),a(this).find(".share-popup").hide()}))},d.handleExpanding=function(){b.find(".vertical-timeline-timeline .item.post").each(function(){a(this).find(".inner").append('<a href="#" class="open-close"></a>')}),"expanded"!=f.defaultExpansion&&(b.find(".vertical-timeline-timeline .item").each(function(){var b=a(this);b.find(".body").hide(),b.find(".post").toggleClass("closed")}),b.find(".expand-collapse-buttons a").removeClass("active"),b.find(".expand-collapse-buttons a.collapse-all").addClass("active")),b.find(".vertical-timeline-timeline .item a.open-close").click(function(c){a(this).siblings(".body").slideToggle(function(){b.find(".vertical-timeline-timeline").isotope("reLayout")}),a(this).parents(".post").toggleClass("closed"),b.find(".expand-collapse-buttons a").removeClass("active"),c.preventDefault()}),b.find(".vertical-timeline-buttons a.expand-all").click(function(c){b.find(".post .body").slideDown(function(){b.find(".vertical-timeline-timeline").isotope("reLayout")}),b.find(".post").removeClass("closed"),b.find(".expand-collapse-buttons a").removeClass("active"),a(this).addClass("active"),c.preventDefault()}),b.find(".vertical-timeline-buttons a.collapse-all").click(function(c){b.find(".post .body").slideUp(function(){b.find(".vertical-timeline-timeline").isotope("reLayout")}),b.find(".post").addClass("closed"),b.find(".expand-collapse-buttons a").removeClass("active"),a(this).addClass("active"),c.preventDefault()})},d.handleSorting=function(){"newest"!=f.defaultDirection&&(b.find(".sort-buttons a").removeClass("active"),b.find(".sort-buttons a.sort-oldest").addClass("active")),b.find(".sort-buttons a").click(function(c){var e=a(this);return e.hasClass("active")?!1:(b.find(".sort-buttons a").removeClass("active"),e.addClass("active"),e.hasClass("sort-newest")?(d.updateGroupMarkers(!1),b.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!1})):(d.updateGroupMarkers(!0),b.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!0})),void c.preventDefault())})},d.handleResizing=function(){f.handleResize===!0&&b.resize(function(){d.adjustWidth(),d.adjustLine()})},d.updateGroupMarkers=function(d){b.find(".group-marker").each(function(){var b=a(this),e=b.attr("data-id"),f=d?c[e].timestampStart:c[e].timestampEnd;b.find(".timestamp").text(f)})},d.adjustWidth=function(){var a,c,d=f.width,e=b.width();"auto"===f.width&&(d=e+"px"),b.find(".vertical-timeline-timeline").width(d),a=b.find(".vertical-timeline-timeline").width(),c=a/2-f.gutterWidth/2-4,b.find(".vertical-timeline-timeline .post").width(c)},d.adjustLine=function(){var a=b.find(".item.last"),c=a.data("isotope-item-position"),d=a.find(".date").height(),e=a.find(".date").position(),f=parseInt(a.find(".inner").css("marginTop"),10),g=e?parseInt(e.top,10):0,h=c||c.y?0:parseInt(c.y,10),i=h+f+g+d/2,j=b.find(".line"),k=b.find(".vertical-timeline-timeline"),l=k.width()/2-j.width()/2;j.height(i).css("left",l+"px")},d.parseRow=function(b){return a.each(f.columnMapping,function(a,c){c=c.split(" ").join(""),b[c]&&(b[a]=b[c])}),b.timestamp=Date.parse(b.date),b},a.isArray(f.data)&&f.data.length>0)data=[],a.each(f.data,function(a,b){data.push(d.parseRow(b))}),d.setupTimeline(data,!1);else{var e=a.extend({key:f.key,callback:d.setupTimeline,wanted:[f.sheetName],postProcess:d.parseRow},f.tabletopOptions);Tabletop.init(e)}})},a.Isotope.prototype._spineAlignReset=function(){this.spineAlign={colA:0,colB:0,lastY:-60}},a.Isotope.prototype._spineAlignLayout=function(b){var c=this,d=this.spineAlign,e=Math.round(this.options.spineAlign&&this.options.spineAlign.gutterWidth)||0,f=Math.round(this.element.width()/2);b.each(function(g){var h,i,j=a(this);if(j.removeClass("last").removeClass("top"),g==b.length-1&&j.addClass("last"),j.hasClass("group-marker")){var k=j.width();h=f-k/2,d.colA>=d.colB?(i=d.colA,0===i&&j.addClass("top"),d.colA+=j.outerHeight(!0),d.colB=d.colA):(i=d.colB,0===i&&j.addClass("top"),d.colB+=j.outerHeight(!0),d.colA=d.colB)}else{j.removeClass("left").removeClass("right");var l=d.colB>=d.colA;if(j.addClass(l?"left":"right"),h=l?f-(j.outerWidth(!0)+e/2):f+e/2,i=l?d.colA:d.colB,i-d.lastY<=60){var m=60-Math.abs(i-d.lastY);j.find(".inner").css("marginTop",m),d.lastY=i+m}else j.find(".inner").css("marginTop",0),d.lastY=i;d[l?"colA":"colB"]+=j.outerHeight(!0)}c._pushPosition(j,h,i)})},a.Isotope.prototype._spineAlignGetContainerSize=function(){var a={};return a.height=this.spineAlign[this.spineAlign.colB>this.spineAlign.colA?"colB":"colA"],a},a.Isotope.prototype._spineAlignResizeChanged=function(){return!0}}(jQuery,window);