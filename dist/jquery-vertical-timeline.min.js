/*! jquery-vertical-timeline - v0.2.1 - 2014-01-21
* https://github.com/MinnPost/jquery-vertical-timeline
* Copyright (c) 2014 MinnPost; Licensed MIT */

!function(a,b,c){a.fn.verticalTimeline=function(b){var d={key:"https://docs.google.com/spreadsheet/pub?key=0AsmHVq28GtVJdG1fX3dsQlZrY18zTVA2ZG8wTXdtNHc&output=html",sheetName:"Posts",defaultDirection:"newest",defaultExpansion:"expanded",groupFunction:"groupSegmentByYear",sharing:!1,gutterWidth:56,width:"auto",handleResize:!1,tabletopOptions:{},columnMapping:{title:"title",title_icon:"title icon",date:"date",display_date:"display date",photo_url:"photo url",caption:"caption",body:"body",read_more_url:"read more url"},postTemplate:'         <div class="item post">           <div class="inner">             <div class="timestamp">{{timestamp}}</div>             <div class="title">                 <h3>                 {{#if title_icon}}<img class="title-icon" src="{{title_icon}}" />{{/if}}                 {{title}}                 </h3>             </div>             <div class="date">{{display_date}}</div>             <div class="body">               {{#if photo_url}}                 <img src="{{photo_url}}" alt="">               {{/if}}               {{#if caption}}                 <div class="caption">({{caption}})</div>               {{/if}}               {{#if body}}                 <div class="text">{{{body}}}</div>               {{/if}}               <div class="clearfix">                 {{#if read_more_url}}                   <a target="_blank" class="more" href="{{read_more_url}}">READ MORE</a>                   {{#if sharing}}                     <div class="share">                       <a href="#" class="share-trigger"></a>                       <div class="share-popup">                         <a href="https://twitter.com/share" class="twitter-share-button" data-url="{{read_more_url}}" data-text="{{title}}" data-count="none">Tweet</a>                         <a class="facebook-share-button" name="fb_share" type="button" share_url="{{read_more_url}}">Share</a>                       </div>                     </div>                   {{/if}}                 {{/if}}               </div>             </div>           </div>         </div>       ',groupMarkerTemplate:'         <div class="item group-marker item-group-{{id}}" data-id="{{id}}">           <div class="inner">             <div class="inner2">               <div class="timestamp">{{timestamp}}</div>               <div class="group">{{groupDisplay}}</div>             </div>           </div>         </div>       ',buttonTemplate:'         <div class="vertical-timeline-buttons clearfix">           <div class="expand-collapse-buttons">             <a class="expand-all active" href="#"><span>Expand all</span></a>             <a class="collapse-all" href="#"><span>Collapse all</span></a>           </div>           <div class="sort-buttons">             <a class="sort-newest active" href="#"><span>Newest first</span></a>             <a class="sort-oldest" href="#"><span>Oldest first</span></a>           </div>         </div>       ',timelineTemplate:'         <div class="vertical-timeline-timeline">           <div class="line-container">             <div class="line"></div>           </div>         </div>       '},e=function(a,b,c){var d=new Date(a.timestamp).getFullYear(),e=d.toString(),f=e.slice(0,-1);return b[f]={id:f,groupDisplay:f+"0's",timestamp:Date.parse("newest"==c?"December 31, "+f+"9":"January 1, "+f+"0"),timestampStart:Date.parse("January 1, "+f+"0"),timestampEnd:Date.parse("December 31, "+f+"9")},b},f=function(a,b,c){var d=new Date(a.timestamp).getFullYear();return b[d]={id:d,groupDisplay:d,timestamp:Date.parse("newest"==c?"December 31, "+d:"January 1, "+d),timestampStart:Date.parse("January 1, "+d),timestampEnd:Date.parse("December 31, "+d)},b},g=function(a,b,c){var d=new Date(a.timestamp).getMonth(),e=new Date(a.timestamp).getFullYear(),f=new Date(a.timestamp).getDate(),g=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],h=Date.parse(g[d]+" "+f+", "+e),i=Date.parse(g[d]+" "+(f+1)+", "+e),j=f+100*(d+100*e);return b[j]={id:j,groupDisplay:g[d]+" "+f+", "+e,timestamp:"newest"==c?i:h,timestampStart:h,timestampEnd:i},b},h=a.extend(d,b);return h.groupFunction="groupSegmentByYear"===h.groupFunction?f:h.groupFunction,h.groupFunction="groupSegmentByDecade"===h.groupFunction?e:h.groupFunction,h.groupFunction="groupSegmentByDay"===h.groupFunction?g:h.groupFunction,this.each(function(){var b=a(this),d={},e={};if(b.addClass("vertical-timeline-container"),b.html(h.buttonTemplate+h.timelineTemplate),e.setupTimeline=function(c,f){var g=Handlebars.compile(h.postTemplate),i=Handlebars.compile(h.groupMarkerTemplate);f&&(c=f.sheets(h.sheetName).all()),a.each(c,function(a,c){d=h.groupFunction(c,d,h.defaultDirection),c.sharing=h.sharing,b.find(".vertical-timeline-timeline").append(g(c))}),a.each(d,function(a,c){b.find(".vertical-timeline-timeline").append(i(c))}),e.handleSharing(),e.handleExpanding(),e.handleSorting(),e.adjustWidth(),e.handleResizing(),b.find(".vertical-timeline-timeline").imagesLoaded(function(){b.find(".vertical-timeline-timeline").isotope({itemSelector:".item",transformsEnabled:!0,layoutMode:"spineAlign",spineAlign:{gutterWidth:h.gutterWidth},getSortData:{timestamp:function(a){return parseFloat(a.find(".timestamp").text())}},sortBy:"timestamp",sortAscending:"newest"==h.defaultDirection?!1:!0,itemPositionDataEnabled:!0,onLayout:function(){e.adjustLine()}})})},e.handleSharing=function(){h.sharing&&(a.getScript("//static.ak.fbcdn.net/connect.php/js/FB.Share"),a.getScript("//platform.twitter.com/widgets.js"),b.find(".vertical-timeline-timeline .post .share").hover(function(){a(this).find(".share-trigger").addClass("over"),a(this).find(".share-popup").show()},function(){a(this).find(".share-trigger").removeClass("over"),a(this).find(".share-popup").hide()}))},e.handleExpanding=function(){b.find(".vertical-timeline-timeline .item.post").each(function(){a(this).find(".inner").append('<a href="#" class="open-close"></a>')}),"expanded"!=h.defaultExpansion&&(b.find(".vertical-timeline-timeline .item").each(function(){var b=a(this);b.find(".body").hide(),b.find(".post").toggleClass("closed")}),b.find(".expand-collapse-buttons a").removeClass("active"),b.find(".expand-collapse-buttons a.collapse-all").addClass("active")),b.find(".vertical-timeline-timeline .item a.open-close").click(function(c){a(this).siblings(".body").slideToggle(function(){b.find(".vertical-timeline-timeline").isotope("reLayout")}),a(this).parents(".post").toggleClass("closed"),b.find(".expand-collapse-buttons a").removeClass("active"),c.preventDefault()}),b.find(".vertical-timeline-buttons a.expand-all").click(function(c){b.find(".post .body").slideDown(function(){b.find(".vertical-timeline-timeline").isotope("reLayout")}),b.find(".post").removeClass("closed"),b.find(".expand-collapse-buttons a").removeClass("active"),a(this).addClass("active"),c.preventDefault()}),b.find(".vertical-timeline-buttons a.collapse-all").click(function(c){b.find(".post .body").slideUp(function(){b.find(".vertical-timeline-timeline").isotope("reLayout")}),b.find(".post").addClass("closed"),b.find(".expand-collapse-buttons a").removeClass("active"),a(this).addClass("active"),c.preventDefault()})},e.handleSorting=function(){"newest"!=h.defaultDirection&&(b.find(".sort-buttons a").removeClass("active"),b.find(".sort-buttons a.sort-oldest").addClass("active")),b.find(".sort-buttons a").click(function(c){var d=a(this);return d.hasClass("active")?!1:(b.find(".sort-buttons a").removeClass("active"),d.addClass("active"),d.hasClass("sort-newest")?(e.updateGroupMarkers(!1),b.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!1})):(e.updateGroupMarkers(!0),b.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!0})),void c.preventDefault())})},e.handleResizing=function(){h.handleResize===!0&&b.resize(function(){e.adjustWidth(),e.adjustLine()})},e.updateGroupMarkers=function(c){b.find(".group-marker").each(function(){var b=a(this),e=b.attr("data-id"),f=c?d[e].timestampStart:d[e].timestampEnd;b.find(".timestamp").text(f)})},e.adjustWidth=function(){var a,c,d=h.width,e=b.width();"auto"===h.width&&(d=e+"px"),b.find(".vertical-timeline-timeline").width(d),a=b.find(".vertical-timeline-timeline").width(),c=a/2-h.gutterWidth/2-4,b.find(".vertical-timeline-timeline .post").width(c)},e.adjustLine=function(){var a=b.find(".item.last"),d=a.data("isotope-item-position"),e=a.find(".date").height(),f=a.find(".date").position(),g=parseInt(a.find(".inner").css("marginTop"),10),h=f===c?0:parseInt(f.top,10),i=d&&d.y?parseInt(d.y,10):0,j=i+g+h+e/2,k=b.find(".line"),l=b.find(".vertical-timeline-timeline"),m=l.width()/2-k.width()/2;k.height(j).css("left",m+"px")},e.parseRow=function(b){return a.each(h.columnMapping,function(a,c){c=c.split(" ").join(""),b[c]&&(b[a]=b[c])}),b.timestamp=Date.parse(b.date),b},a.isArray(h.data)&&h.data.length>0)data=[],a.each(h.data,function(a,b){data.push(e.parseRow(b))}),e.setupTimeline(data,!1);else{var f=a.extend({key:h.key,callback:e.setupTimeline,wanted:[h.sheetName],postProcess:e.parseRow},h.tabletopOptions);Tabletop.init(f)}})},a.Isotope.prototype._spineAlignReset=function(){this.spineAlign={colA:0,colB:0,lastY:-60}},a.Isotope.prototype._spineAlignLayout=function(b){var c=this,d=this.spineAlign,e=Math.round(this.options.spineAlign&&this.options.spineAlign.gutterWidth)||0,f=Math.round(this.element.width()/2);b.each(function(g){var h,i,j=a(this);if(j.removeClass("last").removeClass("top"),g==b.length-1&&j.addClass("last"),j.hasClass("group-marker")){var k=j.width();h=f-k/2,d.colA>=d.colB?(i=d.colA,0===i&&j.addClass("top"),d.colA+=j.outerHeight(!0),d.colB=d.colA):(i=d.colB,0===i&&j.addClass("top"),d.colB+=j.outerHeight(!0),d.colA=d.colB)}else{j.removeClass("left").removeClass("right");var l=d.colB>=d.colA;if(j.addClass(l?"left":"right"),h=l?f-(j.outerWidth(!0)+e/2):f+e/2,i=l?d.colA:d.colB,i-d.lastY<=60){var m=60-Math.abs(i-d.lastY);j.find(".inner").css("marginTop",m),d.lastY=i+m}else j.find(".inner").css("marginTop",0),d.lastY=i;d[l?"colA":"colB"]+=j.outerHeight(!0)}c._pushPosition(j,h,i)})},a.Isotope.prototype._spineAlignGetContainerSize=function(){var a={};return a.height=this.spineAlign[this.spineAlign.colB>this.spineAlign.colA?"colB":"colA"],a},a.Isotope.prototype._spineAlignResizeChanged=function(){return!0}}(jQuery,window);